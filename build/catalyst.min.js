"use strict";export default class Catalyst{constructor(t,e=[],s=0,r,i="."){let h=typeof t;if("undefined"!=h){if(Array.isArray(t))throw"Expected object, got array.";if("object"!=h)throw"Expected object, got value."}for(var o in this.accessor=i,this.resolveMode=!1,this.resolveContext=!1,this.preserveReferences=!0,this.preserveFragments=!0,this.history=e,this.historyFeed=r||((t,e,s)=>!1),this.historyLogger=this.logChange.bind(this),this.historyLimit=0,this.historyBatchModes=[],this.historyDisabled=0,this.historyCurrent=s,this.historyBatched=0,this.historyObservers={},this.batchStarter=this.batch.bind(this),this.batchStopper=this.stopBatch.bind(this),this.prunePending=!1,this.fragmented={},this.fragments={},this.observers={},this.observed={prop:{},child:{},deep:{}},this.observerNotifier=this.notifyObservers.bind(this),this.observeAsync=!0,this.observeDeferred=0,this.observations={stacks:[],paths:{}},this.interceptors={},this.intercepted={prop:{},child:{},deep:{}},this.interceptorNotifier=this.notifyInterceptors.bind(this),this.setterLevel=0,this.setterBatched=!1,this.root={},this.store=this.proxify(this.root,this,"",[]),this.stopRecord(),t)this.store[o]=t[o];this.record();let n=()=>this.accessor,a=()=>this.preserveReferences,p=t=>this.preserveReferences=t,c=()=>this.preserveFragments,f=t=>this.preserveFragments=t,d=()=>this.historyCurrent,l=t=>t>=this.historyCurrent?t!=this.historyCurrent&&this.undo(t-this.historyCurrent):this.redo(this.historyCurrent-t),y=()=>this.historyLimit,g=t=>{this.historyLimit=t,this.prune()},b=()=>this.history,u=()=>this.historyFeed,v=t=>this.historyFeed=t,m=()=>this.historyDisabled,O=t=>{"number"==typeof t?(t<0&&(t=0),this.historyDisabled=t):this.historyDisabled=t?this.historyDisabled||1:0},B=()=>this.historyBatched,j=t=>{if("number"==typeof t){if(t>this.historyBatched)0==this.historyBatched&&this.batch();else if(t<this.historyBatched&&(t<0&&(t=0),this.historyBatched>0))for(;this.historyBatched>t;)this.stopBatch()}else if(t)this.historyBatched||this.batch();else if(this.historyBatched)for(;this.historyBatched>0;)this.stopBatch()},x=()=>this.historyBatchModes,P=()=>this.observeAsync,C=t=>this.observeAsync=t,D=()=>this.observeDeferred,w=t=>{if("number"==typeof t){if(t>this.observeDeffered)0==this.observeDeffered&&this.deferObservers();else if(t<this.observeDeffered&&(t<0&&(t=0),this.observeDeffered>0))for(;this.observeDeffered>t;)this.resumeObservers()}else if(t)this.observeDeffered||this.deferObservers();else if(this.observeDeffered)for(;this.observeDeffered>0;)this.resumeObservers()},F=()=>this.store;return this.catalyst={get accessor(){return n()},get preserveReferences(){return a()},set preserveReferences(t){p(t)},get preserveFragments(){return c()},set preserveFragments(t){f(t)},record:this.record.bind(this),stopRecord:this.stopRecord.bind(this),batch:this.batch.bind(this),stopBatch:this.stopBatch.bind(this),undo:this.undo.bind(this),redo:this.redo.bind(this),commit:this.commit.bind(this),prune:this.prune.bind(this),observeHistory:this.observeHistory.bind(this),stopObserveHistory:this.stopObserveHistory.bind(this),get history(){return b()},get historyCurrent(){return d()},set historyCurrent(t){return l(t)},get historyLimit(){return y()},set historyLimit(t){g(t)},get historyFeed(){return u()},set historyFeed(t){v(t)},get isHistoryDisabled(){return m()},set isHistoryDisabled(t){O(t)},get isHistoryBatched(){return B()},set isHistoryBatched(t){j(t)},get historyBatchModes(){return x()},parse:this.parse.bind(this),path:this.path.bind(this),parent:this.parent.bind(this),fragment:this.metaProxify(this.fragment,this),isFragment:this.metaProxify(function(t){if(void 0===t)return 0;if("object"==typeof t)return this.isFragment(t);if("string"==typeof t)return this.isFragment(t);throw"Expected string, object or undefined, got"+typeof t+"."},this),get fragmentPath(){return""},augment:this.metaProxify(this.augment,this),observe:this.metaProxify(function(t,e,s=!1,r=!1,i=!0){return this.observe(t,e,s,r,i,this.catalyst)},this),stopObserve:this.stopObserve.bind(this),deferObservers:this.deferObservers.bind(this),resumeObservers:this.resumeObservers.bind(this),refresh:this.metaProxify(this.refresh,this),get isObserveAsync(){return P()},set isObserveAsync(t){C(t)},get isObserveDeferred(){return D()},set isObserveDeferred(t){w(t)},intercept:this.metaProxify(function(t,e,s=!1,r=!1){return this.intercept(t,e,s,r,this.catalyst)},this),stopIntercept:this.stopIntercept.bind(this),get store(){return F()}},this.catalyst}timestamp(){let t=Date.now();return t==this._timestamp?this._timestampCounter++:(this._timestamp=t,this._timestampCounter=1),t.toString()+("00"+this._timestampCounter).slice(-3)}record(){this.historyDisabled--,this.historyDisabled<0&&(this.historyDisabled=0)}stopRecord(){this.historyDisabled++}batch(t=!1,e=!0){this.historyBatched||this.history.push({timestamp:this.timestamp(),changelog:[]}),this.historyBatched++,this.historyBatchModes.push({aggregate:t,preserveOrder:e,count:0,map:{}})}stopBatch(){let t=!1,e=!1;if(this.historyBatched>0){if(this.historyBatchModes[this.historyBatched-1].aggregate&&!this.historyBatchModes[this.historyBatched-1].preserveOrder){let t=this.historyBatchModes[this.historyBatched-1].map;for(var s in t)this.history[this.history.length-1].changelog.push(t[s])}this.historyBatchModes.splice(-1,1),1==this.historyBatched&&(0==this.history[this.history.length-1].changelog.length?this.history.splice(-1,1):t=!0,e=!0)}this.historyBatched--,this.historyBatched<0&&(this.historyBatched=0),t&&this.notifyHistoryObservers(this.history[this.history.length-1],"add"),e&&this.historyLimit&&!this.prunePending&&(this.prunePending=!0,Promise.resolve(!0).then(()=>this.prune()))}logChange(t){if(this.historyDisabled)return!1;if(this.commit(),this.historyBatched)if(this.historyBatchModes[this.historyBatched-1].aggregate)if(this.historyBatchModes[this.historyBatched-1].preserveOrder){let e=this.history[this.history.length-1].changelog.length;if(e>0&&this.historyBatchModes[this.historyBatched-1].count>0){t.slice(0,t.indexOf("="))!=this.history[this.history.length-1].changelog[e-1].slice(0,this.history[this.history.length-1].changelog[e-1].indexOf("="))&&(this.history[this.history.length-1].changelog.push(t),this.historyBatchModes[this.historyBatched-1].count++)}else this.history[this.history.length-1].changelog.push(t),this.historyBatchModes[this.historyBatched-1].count++}else{let e=t.slice(0,t.indexOf("="));void 0===this.historyBatchModes[this.historyBatched-1].map[e]&&(this.historyBatchModes[this.historyBatched-1].map[e]=t)}else this.history[this.history.length-1].changelog.push(t);else this.history.push({timestamp:this.timestamp(),changelog:[t]}),this.notifyHistoryObservers(this.history[this.history.length-1],"add"),this.historyLimit&&!this.prunePending&&(this.prunePending=!0,Promise.resolve(!0).then(()=>this.prune()));return!0}undo(t=1,e=!0){let s=this.historyCurrent+t,r=0,i=null;i=this.history.length==this.historyCurrent?this.history.length>0?this.history[0].timestamp:this.timestamp():this.history[this.history.length-this.historyCurrent-1].timestamp,this.historyLogger=(()=>!1),this.interceptorNotifier=((t,e,s,r)=>r),this.batchStarter=(()=>!1),this.batchStopper=(()=>!1);let h=this.preserveFragments;for(this.preserveFragments=!1,e&&this.deferObservers();this.historyCurrent<s;){if(this.history.length-this.historyCurrent==0){let t="function"==typeof this.historyFeed&&this.historyFeed(this.historyCurrent+1,s,i);if(!t)break;this.history.unshift(...t)}let t=this.history[this.history.length-this.historyCurrent-1];t.oplog||(t.oplog=[]);for(var o=t.changelog.length-1;o>=0;o--){let e=t.changelog[o],s=e.indexOf("="),r=e.slice(0,s),i=e.slice(s+1),h=this.store,a=r.split(this.accessor);a.shift();for(var n=0;n<a.length-1;n++)h=h[a[n]];t.oplog.length<t.changelog.length-o&&(this.historyLogger=(e=>(t.oplog.unshift(e),this.historyLogger=(()=>!1),!0))),i.length?h[a[a.length-1]]=JSON.parse(i):delete h[a[a.length-1]]}i=t.timestamp,r++,this.historyCurrent++,this.notifyHistoryObservers(t,"update")}return e&&this.resumeObservers(),this.preserveFragments=h,this.batchStarter=this.batch.bind(this),this.batchStopper=this.stopBatch.bind(this),this.interceptorNotifier=this.notifyInterceptors.bind(this),this.historyLogger=this.logChange.bind(this),r}redo(t=1,e=!0){if(0==this.historyCurrent)return 0;let s=this.historyCurrent-t,r=0;s=s<0?0:s,this.historyLogger=(()=>!1),this.interceptorNotifier=((t,e,s,r)=>r),this.batchStarter=(()=>!1),this.batchStopper=(()=>!1);let i=this.preserveFragments;for(this.preserveFragments=!1,e&&this.deferObservers();this.historyCurrent>s;){let t=this.history[this.history.length-this.historyCurrent];for(var h=0;h<t.oplog.length;h++){let e=t.oplog[h],s=e.indexOf("="),r=e.slice(0,s),i=e.slice(s+1),n=this.store,a=r.split(this.accessor);a.shift();for(var o=0;o<a.length-1;o++)n=n[a[o]];i.length?n[a[a.length-1]]=JSON.parse(i):delete n[a[a.length-1]]}delete t.oplog,r++,this.historyCurrent--,this.notifyHistoryObservers(t,"update")}return e&&this.resumeObservers(),this.preserveFragments=i,this.batchStarter=this.batch.bind(this),this.batchStopper=this.stopBatch.bind(this),this.interceptorNotifier=this.notifyInterceptors.bind(this),this.historyLogger=this.logChange.bind(this),r}commit(){if(this.historyCurrent>0){for(var t=0;t<this.historyCurrent;t++)this.notifyHistoryObservers(this.history.pop(),"delete");this.historyCurrent=0}}prune(t){if(t||(this.prunePending=!1),!(t=t||this.historyLimit))return[];t=t>this.historyCurrent?t:historyCurrent;let e=this.history.length-t;return e<=0?[]:this.history.splice(0,e)}observeHistory(t){let e=this.timestamp();return this.historyObservers[e]=t,e}stopObserveHistory(t){return!!this.historyObservers.hasOwnProperty(t)&&(delete this.historyObservers[t],!0)}notifyHistoryObservers(t,e){Object.values(this.historyObservers).forEach(s=>{this.observeAsync?Promise.resolve().then(()=>s(e,t,this.store)):s(e,t,this.store)})}parse(t){if(!t.length)throw"Path is an empty string.";let e=t.split(this.accessor);return t[0]==this.accessor&&e.shift(),e.reduce((t,e)=>void 0===t?t:0==e.length?t:t[e],this.store)}path(t){if("object"!=typeof t)throw"Expected object, got "+typeof t+".";let e=this.resolve(t,!0);return path=e.path,path}parent(t){if("string"==typeof t){if(0==t.length)throw"Path is an empty string.";let e=t.split(this.accessor);return t[0]==this.accessor&&e.shift(),e.pop(),e.reduce((t,e)=>e.length>0?t&&t[e]:t,this.store)}if("object"==typeof t){let e=this.resolve(t,!0).path;return this.parent(e)}throw"Expected string or object, got "+typeof t+"."}isFragment(t){let e;if("object"==typeof t)e=this.path(t);else{if("string"!=typeof t)throw"Expected string or object, got "+typeof t+".";e=t}return e.length?(e[0]!=this.accessor&&(e=this.accessor+e),"object"==typeof this.fragmented[e]?Object.keys(this.fragmented[e]).length:0):0}fragment(t,e){let s;if("object"==typeof t)s=this.path(t);else{if("string"!=typeof t)throw"Expected string or object, got "+typeof t+".";s=t}if(!s.length)throw"Path is an empty string.";s[0]!=this.accessor&&(s=this.accessor+s);let r=this.parse(s);if("object"!=typeof r)throw"Path must represent an existing valid part of the store.";this._fragCounter=(this._fragCounter||1)+1;let i=this._fragCounter,h={observers:[],interceptors:[]},o={catalyst:this.catalyst,stopObserve:this.stopObserve.bind(this),stopIntercept:this.stopIntercept.bind(this),get store(){return r},get fragmentPath(){return s},get fragmentId(){return i}},n=t=>t.length>0?s+("."==t[0]?"":".")+t:s;return o.isFragment=this.metaProxify(function(t){if(void 0===t)return this.isFragment(s);if("object"==typeof t)return this.isFragment(t);if("string"==typeof t)return this.isFragment(n(t));throw"Expected string, object or undefined, got"+typeof t+"."},this),o.parent=function(t){if(void 0===t)return this.parent(s);if("object"==typeof t)return this.parent(t);if("string"==typeof t)return this.parent(n(t));throw"Expected string, object or undefined, got"+typeof t+"."}.bind(this),o.parse=function(t){return this.parse(n(t))}.bind(this),o.fragment=this.metaProxify(function(t,e){if(void 0===t)return this.fragment(s,e);if("object"==typeof t)return this.fragment(t,e);if("string"==typeof t)return this.fragment(n(t),e);throw"Expected string, object or undefined, got"+typeof t+"."},this),o.dissolve=function(){return!!this.fragments.hasOwnProperty(i)&&("function"==typeof e&&e(o),h.observers.forEach(t=>this.stopObserve(t)),h.interceptors.forEach(t=>this.stopIntercept(t)),delete o.catalyst,delete o.stopObserve,delete o.stopIntercept,delete o.parent,delete o.parse,delete o.isFragment,delete o.fragment,delete o.dissolve,delete o.augment,delete o.observe,delete o.refresh,delete o.intercept,delete this.fragmented[s][i],delete this.fragments[i],h=void 0,r=void 0,s=void 0,i=void 0,e=void 0,!0)}.bind(this),o.augment=this.metaProxify(function(t){if(void 0===t)return this.augment(s);if("object"==typeof t)return this.augment(t);if("string"==typeof t)return this.augment(n(t));throw"Expected string, object or undefined, got"+typeof t+"."},this),o.observe=this.metaProxify(function(t,e,r=!1,i=!1,a=!0){if(void 0===t)h.observers.push(this.observe(s,e,r,i,a,o));else if("object"==typeof t)h.observers.push(this.observe(t,e,r,i,a,o));else{if("string"!=typeof t)throw"Expected string, object or undefined, got"+typeof t+".";h.observers.push(this.observe(n(t),e,r,i,a,o))}return h.observers[h.observers.length-1]},this),o.refresh=this.metaProxify(function(t){if(void 0===t)return this.refresh(s);if("object"==typeof t)return this.refresh(t);if("string"==typeof t)return this.refresh(n(t));throw"Expected string, object or undefined, got"+typeof t+"."},this),o.intercept=this.metaProxify(function(t,e,r=!1,i=!1){if(void 0===t)h.interceptors.push(this.intercept(s,e,r,i,o));else if("object"==typeof t)h.interceptors.push(this.intercept(t,e,r,i,o));else{if("string"!=typeof t)throw"Expected string, object or undefined, got"+typeof t+".";h.interceptors.push(this.intercept(n(t),e,r,i,o))}return h.interceptors[h.interceptors.length-1]},this),this.fragments[i]=o,this.fragmented[s]||(this.fragmented[s]={}),this.fragmented[s][i]=!0,o}augment(t){let e;if("object"==typeof t)e=this.path(t);else{if("string"!=typeof t)throw"Expected string or object, got "+typeof t+".";e=t}if("string"!=typeof e)return!1;if(0==e.length)return!1;if("object"!=typeof this.fragmented[e])return!1;let s=Object.keys(this.fragmented[e]);return 0!=s.length&&(s.forEach(t=>this.fragments[t].dissolve()),!0)}resolve(t,e=!1){this.resolveMode=!0,this.resolveContext=e;let s=t.anything;return this.resolveMode=!1,this.resolveContext=!1,s}metaProxify(t,e){let s=function(r,i,h){let o={path:this.path+e.accessor+i};return new Proxy(function(){return t.apply(e,[this.path,...arguments])}.bind(o),{get:s.bind(o)})};return new Proxy(t.bind(e),{get:s.bind({path:""})})}proxify(t,e,s,r){let i={self:e,path:s,paths:r},h={get:e.handleGet.bind(i),set:e.handleSet.bind(i),deleteProperty:e.handleDelete.bind(i)};return new Proxy(t,h)}deepProxify(t,e,s,r,i,h,o,n,a){if(t==e)return e;let p="object"==typeof t,c="object"==typeof e;if(c||p){let d=Array.isArray(t),l=Array.isArray(e),y=!1;c&&"object"==typeof this.fragmented[s]&&Object.keys(this.fragmented[s]).length>0&&(y=!0);let g,b=this.preserveReferences||y;if(y&&(!p||p&&d!=l)){if(this.preserveFragments)return e;this.augment(s)}let u=t=>b?this.resolve(e):t;l&&d?g=u([]):l&&p?g={}:p&&d?g=[]:c&&p?g=u({}):l?g=u([]):d?g=[]:c?g=u({}):p&&(g={});let v=Array.isArray(g),m=c&&!p,O=[],B=t=>{b&&(m?O.push(t):delete g[t]),n.changes++},j=()=>{m&&(m=!1,O.forEach(t=>delete g[t]),O=[])},x=f=>{let d,l,y=p?t[f]:void 0,u=c?e[f]:void 0,v="object"==typeof u,m=c?a[f]:void 0;if(y!=u){if(c&&v){let t=this.resolve(u,!0);d=t.path,l=t.paths}else d=s+this.accessor+f,(l=r.slice()).push(s);if((y=this.interceptorNotifier(d,void 0,void 0,y,u,o,i,!0,!0))!=u){if("object"==typeof y)g[f]=this.deepProxify(y,u,d,l,i,h,o,n,m),v||n.changes++,j();else if(void 0===y)if(v){let t=this.deepProxify(void 0,u,d,l,i,h,o,n,m);void 0!==t?(g[f]=t,j()):B(f)}else B(f);else{if(v){let t=this.deepProxify(void 0,u,d,l,i,h,o,n,m);void 0!==t?g[f]=t:(g[f]=y,n.changes++)}else g[f]=y,n.changes++;j()}n.observations.push({path:d,oldVal:m,propOnly:!0})}else b||(g[f]=u)}else b||(g[f]=u)},P={};if(c)for(var f in e)P[f]=!0;if(p)for(var f in t)P[f]=!0;for(var f in P)x(f);let C=()=>{this.resolve(e,!0).passthrough=!0},D=()=>{if(v&&d&&l&&b){let t=0;g.forEach((e,s)=>t=s>t?s:t),g.length=t+1}return c&&l==d&&b?e:(c&&C(),this.proxify(g,this,s,r))};return p?D():Object.keys(g).length-O.length>0?D():("object"!=typeof t&&c&&C(),t)}return n.changes++,t}handleSet(t,e,s,r){if(1==this.passthrough)return t[e]=s,!0;if(t[e]==s)return!0;let i,h,o,n,a=this.self,p=t[e],c=typeof p,f={observations:[],changes:0};if("object"==c){let t=a.resolve(p,!0);o=t.path,n=t.paths}else o=this.path+a.accessor+e,(n=this.paths.slice()).push(this.path);a.setterLevel++,2==a.setterLevel&&(a.setterBatched||(a.batchStarter(),a.setterBatched=!0));let d=()=>{a.setterLevel--,0==a.setterLevel&&a.setterBatched&&(a.batchStopper(),a.setterBatched=!1)};try{s=a.interceptorNotifier(o,this.path,this.paths,s,p,o,s)}catch(t){return console.error("Discard update ("+o+") - encountered error!",t),d(),!1}if(s==p)return d(),!0;try{let r;"object"!=c&&a.historyDisabled||(r=JSON.stringify(p)),a.historyDisabled||(i=o+"=","undefined"!=c&&(i+=r)),h="object"==c?JSON.parse(r):p;let l=a.deepProxify(s,p,o,n,s,p,o,f,h);if(l==p){if("object"!=typeof l)return d(),!0;if(0==f.changes)return d(),!0}else void 0===l?delete t[e]:t[e]=l}catch(t){return console.error("Discard update ("+o+") - encountered error!",t),d(),!1}a.historyDisabled||a.historyLogger(i),d(),f.observations.push({path:o,pathc:this.path,paths:this.paths,oldVal:h,propOnly:!1});let l=()=>f.observations.forEach(t=>a.observerNotifier(t.path,t.pathc,t.paths,t.oldVal,o,h,t.propOnly));return this.observeAsync?Promise.resolve().then(l):l(),!0}handleDelete(t,e,s){return this.self.handleSet.bind(this)(t,e,void 0,s)}handleGet(t,e){return this.self.resolveMode?this.self.resolveContext?this:t:t[e]}observe(t,e,s=!1,r=!1,i=!0,h){let o;if("object"==typeof t)o=this.path(t);else{if("string"!=typeof t)throw"Expected string or object, got "+typeof t+".";o=t}if(!o.length)return!1;o[0]!=this.accessor&&(o=this.accessor+o),h=h||this.catalyst,this._obsCounter=(this._obsCounter||1)+1;let n=this._obsCounter,a=(t,e)=>{this.observed[e][t]||(this.observed[e][t]=new Map),this.observed[e][t].set(n,!0)};if(this.observers[n]={path:o,fn:e,children:s||r,deep:r,origin:h},a(o,"prop"),(s||r)&&a(o,"child"),r&&a(o,"deep"),i){let t=()=>e(o.substr(h.fragmentPath.length),void 0,o,void 0);this.observeAsync?Promise.resolve(!0).then(t):t()}return n}stopObserve(t){if(this.observers.hasOwnProperty(t)){let s=this.observers[t].path;this.observed.prop[s].delete(t),this.observed.child[s]&&this.observed.child[s].has(t)&&this.observed.child[s].delete(t);let r="",i=s.split(this.accessor);i.shift();for(var e=0;e<i.length;e++)r=r+this.accessor+i[e],this.observed.deep[r]&&this.observed.deep[r].has(t)&&this.observed.deep[r].delete(t);return delete this.observers[t],!0}return!1}notifyObservers(t,e,s,r,i,h,o=!1,n=!1){if(this.observeDeferred>0&&!n){let n=this.observations.paths[t];if(void 0!==n){let r=this.observations.stacks[n].get(t);this.observations.stacks[n].delete(t),this.observations.paths[t]=this.observeDeferred-1,this.observations.stacks[this.observeDeferred-1].set(t,{path:t,pathc:e,paths:s,oldVal:r.oldVal,path_:i,oldVal_:h,propOnly:r.propOnly&&o})}else this.observations.paths[t]=this.observeDeferred-1,this.observations.stacks[this.observeDeferred-1].set(t,{path:t,pathc:e,paths:s,oldVal:r,path_:i,oldVal_:h,propOnly:o})}else{let n=e=>{let s=this.observers[e];s.fn(t.substr(s.origin.fragmentPath.length),r,s.origin,i,h)};if(this.observed.prop[t])for(var a of this.observed.prop[t].keys())n(a);if(!o){if(this.observed.child[e])for(var a of this.observed.child[e].keys())n(a);for(var p=s.length-1;p>=0;p--)if(this.observed.deep[s[p]])for(var a of this.observed.deep[s[p]].keys())n(a)}}}deferObservers(){this.observations.stacks.push(new Map),this.observeDeferred++}resumeObservers(t=!1){if(0==this.observeDeferred)return;this.observeDeferred--;let e=()=>{let e=t?0:this.observeDeferred;for(;e<=this.observeDeferred;)this.observations.stacks[e].forEach(t=>{delete this.observations.paths[t.path],this.observerNotifier(t.path,t.pathc,t.paths,t.oldVal,t.path_,t.oldVal_,t.propOnly,!0)}),e++;t?this.observations.stacks=[]:this.observations.stacks.pop()};this.observeAsync?Promise.resolve().then(e):e()}refresh(t){let e,s,r;if("string"==typeof t){if(0==t.length)throw"Path is an empty string";t[0]!=this.accessor&&(t=this.accessor+t);let i=this.parse(t);if("object"==typeof i)return this.refresh(i);e=t;let h=t.split(this.accessor);t[0]==this.accessor&&h.shift(),h.pop(),s=this.accessor+h.join(this.accessor),h.pop();let o=[];h=h.forEach((t,e)=>{o.push((0==e?"":o[e-1])+this.accessor+t)}),r=o}else{if("object"!=typeof t)throw"Expected string or object, got "+typeof t+".";{let i=this.resolve(t,!0),h=this.resolve(this.parent(t),!0);e=i.path,s=h.path,r=h.paths}}this.observerNotifier(e,s,r,void 0,e,void 0,!1,!0)}intercept(t,e,s=!1,r=!1,i){let h;if("object"==typeof t)h=this.path(t);else{if("string"!=typeof t)throw"Expected string or object, got "+typeof t+".";h=t}if(!h.length)return!1;h[0]!=this.accessor&&(h=this.accessor+h),i=i||this.catalyst,this._iceptCounter=(this._iceptCounter||1)+1;let o=this._iceptCounter,n=(t,e)=>{this.intercepted[e][t]||(this.intercepted[e][t]=new Map),this.intercepted[e][t].set(o,!0)};return this.interceptors[o]={path:h,fn:e,children:s||r,deep:r,origin:i},n(h,"prop"),(s||r)&&n(h,"child"),r&&n(h,"deep"),o}stopIntercept(t){if(this.interceptors.hasOwnProperty(t)){let s=this.interceptors[t].path;this.intercepted.prop[s].delete(t),this.intercepted.child[s]&&this.intercepted.child[s].has(t)&&this.intercepted.child[s].delete(t);let r="",i=s.split(this.accessor);i.shift();for(var e=0;e<i.length;e++)r=r+this.accessor+i[e],this.intercepted.deep[r]&&this.intercepted.deep[r].has(t)&&this.intercepted.deep[r].delete(t);return delete this.interceptors[t],!0}return!1}notifyInterceptors(t,e,s,r,i,h,o,n=!1,a=!0){let p=e=>{let s=this.interceptors[e];return s.fn(t.substr(s.origin.fragmentPath.length),r,s.origin,h,o)};if(!n){for(var c=0;c<=s.length-1;c++)if(this.intercepted.deep[s[c]])for(var f of this.intercepted.deep[s[c]].keys())if(r=p(f),a&&r==i)return r;if(this.intercepted.child[e])for(var f of this.intercepted.child[e].keys())if(r=p(f),a&&r==i)return r}if(this.intercepted.prop[t])for(var f of this.intercepted.prop[t].keys())if(r=p(f),a&&r==i)return r;return r}};